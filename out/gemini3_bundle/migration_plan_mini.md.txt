# Migration Plan for the GPT-5.1 CLI Agent
1. **Branch setup.** From `master`, create the feature branch `infra/reorg-$(date +%Y%m%d)` (or the date you actually run the migration). Ensure the working tree is clean, fetch the latest remote, and keep `master` as the trunk so downstream merges have a known base.
2. **Bring in the donor logic.** Merge `claude/sip-escalate-integration-011CV2nwLukS7EtnB5iZUUe7` into `infra/reorg-YYYYMMDD` (fast-forward if the branch is up-to-date, otherwise `git merge --no-ff`). Resolve conflicts, run the AST scanners (`scripts/scan_if_functions.py`, `scripts/scan_if_mentions.py`) on the merged tree if needed, and verify that `out/branches/claude/.../summary.txt` still shows the two `if_*` definitions before proceeding.
3. **Apply the reorganized tree.** Use `git mv` for each mapping in `out/moves_expanded.csv` (start with guardians/cycles docs, then ingestion, orchestration, meta, and tooling). After moving files, run `python3 scripts/update_links.py --mapping out/moves_expanded.csv --dry-run` from the repo root to catch stale references, fix any reported gaps manually, then rerun without `--dry-run` to rewrite hyperlinks. Verify that `scripts/bulk_move_and_update.sh out/moves_expanded.csv` would be redundant once the manual moves and link fix are done, but keep it handy for future bulk sweeps.
4. **Rebuild the branch scans.** Execute `~/infrafabric-tools/run_branch_scans.sh` so every branch, including the reorganized one, regenerates its `out/branches/<branch>/` data (manifests, `if_index.json`, `if_mentions.json`, Yologuard/secrets). Follow up by rerunning `scripts/scan_if_functions.py`/`scan_if_mentions.py` on the reorganized tree if you moved code that the scanners should re-index. Update `out/aggregate_report.md`, `out/if_relationship_map.*`, and `out/summary.txt` to reflect the new tree before finishing the commit.
5. **Triage secrets, Yologuard, and UNDEF issues.** Review the high-hit files listed in `out/secrets_yologuard_risk_mini.md` (annexes, the Yologuard requirements, the security playbooks) and scrub or rotate any embedded secrets before merging. Document how you resolved the ambiguous call graph nodes noted in `out/undef_callgraph_notes_mini.md`—either by remapping them to concrete `if_*` functions or by noting that they remain dynamic—so the post-reorg call graph is clean.
6. **Finalize outputs.** With the reorganized tree in place, regenerate `out_bundle_v2.zip` (e.g., `cd /home/setup/infrafabric && zip -rq out_bundle_v2.zip out/`) and author `out/gpt5pro_bundle_v2.md` to describe the refreshed bundle (new tree, updated scans, outstanding risks). Document in that bundle what changed from the previous version and flag any remaining action items so reviewers can rely on the new artifacts.
