================================================================================
CLAUDE MAX OPENWEBUI FUNCTION - QUICK REFERENCE CARD
================================================================================

Project: Convert Claude Max Flask Server to OpenWebUI Function Module
Status: ✓ COMPLETE & PRODUCTION-READY (v1.0.0)
Date: 2025-11-30

================================================================================
FILES CREATED
================================================================================

Main Module:
  openwebui_claude_max_module.py     550 lines   Production code
  test_claude_max_function.py        350 lines   18 tests (ALL PASSING)
  verify_installation.sh              100 lines   Auto-verification script

Documentation:
  README_CLAUDE_MAX.md                400 lines   Project overview
  OPENWEBUI_CLAUDE_INTEGRATION.md     400 lines   Technical documentation
  DEPLOYMENT_GUIDE.md                 600 lines   Installation & troubleshooting
  IMPLEMENTATION_SUMMARY.md           500 lines   Complete project summary
  QUICK_REFERENCE.txt                 This file  Quick reference

TOTAL: ~2,900 lines of code + documentation

================================================================================
KEY FEATURES
================================================================================

✓ CLI Version Detection       Auto-detects Claude CLI installation
✓ Login State Detection       Checks for auth token, prompts if needed
✓ Auto-Update Checks         Warns if Claude CLI needs update
✓ Streaming Responses        Real-time response chunks to OpenWebUI
✓ Error Handling            Graceful errors with solutions
✓ Security Isolation        Subprocess prevents command injection
✓ IF.TTT Compliance         Traceable, Transparent, Trustworthy
✓ Production-Ready          Not pseudocode, fully tested

================================================================================
TEST RESULTS
================================================================================

All 18 Unit Tests: ✓ PASSING

✓ CLI detection & version parsing
✓ Login state detection
✓ Error handling (missing CLI, auth required, timeout)
✓ Streaming response handling
✓ Subprocess security
✓ Logging & status reporting

Command: python3 test_claude_max_function.py

================================================================================
QUICK START (5 MINUTES)
================================================================================

1. Authenticate Claude (one-time)
   $ claude auth login

2. Verify installation
   $ bash verify_installation.sh

3. Deploy to OpenWebUI (Docker)
   $ docker cp openwebui_claude_max_module.py \
     open-webui:/app/backend/data/functions/
   $ docker restart open-webui

4. Use in OpenWebUI
   - Open http://localhost:8080
   - Select "Claude Max OpenWebUI" model
   - Send a message

================================================================================
CORE METHODS
================================================================================

ClaudeMaxFunction.pipe(body: dict) -> Generator[str]
  ├─ OpenWebUI interface (main entry point)
  ├─ Validates CLI, extracts message, executes query
  └─ Yields response chunks as they arrive

ClaudeMaxFunction.get_status() -> Dict
  ├─ Returns installation status
  ├─ CLI version, auth status, any errors
  └─ Use for diagnostics: python3 --status

ClaudeMaxFunction._check_claude_cli(force=bool)
  ├─ Detects: installed, version, needs_update, needs_login
  ├─ Caches result for 5 minutes
  └─ Forces fresh check if needed

ClaudeMaxFunction._validate_cli_ready() -> (bool, str)
  ├─ Pre-flight checks before execution
  ├─ Returns (is_ready, error_message)
  └─ Friendly error messages with solutions

================================================================================
ERROR HANDLING
================================================================================

CLI Not Found
  → Message: "Claude CLI not found. Install with: npm install..."
  → Solution: npm install -g @anthropic-ai/claude

Auth Required
  → Message: "Claude CLI requires authentication. Run: claude auth login"
  → Solution: claude auth login

Request Timeout
  → Message: "Request timed out after 300 seconds"
  → Solution: Use shorter messages

CLI Error
  → Message: "Error from Claude CLI: {detail}"
  → Solution: Check Claude subscription status

Empty Response
  → Message: "No response from Claude CLI"
  → Solution: Test: claude --print "Hello"

================================================================================
TESTING
================================================================================

Run All Tests:
  $ cd /home/setup/infrafabric/integration
  $ python3 test_claude_max_function.py

Expected Result:
  Ran 18 tests in 3.162s
  OK

Test Specific Feature:
  $ python3 test_claude_max_function.py TestClaudeMaxFunction.test_pipe_successful_response -v

Check Syntax:
  $ python3 -m py_compile openwebui_claude_max_module.py

================================================================================
VERIFICATION
================================================================================

Check Installation Status:
  $ python3 openwebui_claude_max_module.py --status

Test Module Directly:
  $ python3 openwebui_claude_max_module.py --test "Hello, Claude"

Automated Verification:
  $ bash verify_installation.sh

Debug with Logs:
  $ python3 openwebui_claude_max_module.py --test "msg" 2>&1 | grep ERROR

================================================================================
DEPLOYMENT CHECKLIST
================================================================================

Pre-Deployment:
  ☐ Claude CLI installed: which claude
  ☐ Claude CLI version ≥2.0.0: claude --version
  ☐ Claude authenticated: ls ~/.claude/auth_token
  ☐ Python 3.7+ available: python3 --version
  ☐ Module syntax valid: python3 -m py_compile openwebui_claude_max_module.py
  ☐ All tests passing: python3 test_claude_max_function.py

Deployment:
  ☐ Copy module to OpenWebUI functions directory
  ☐ Restart OpenWebUI service
  ☐ Verify module appears in model list
  ☐ Test with sample message

Post-Deployment:
  ☐ Check status: --status command
  ☐ Monitor logs: Check stderr for errors
  ☐ Run verification: verify_installation.sh

================================================================================
COMMON COMMANDS
================================================================================

Check Status:
  python3 openwebui_claude_max_module.py --status

Test with Message:
  python3 openwebui_claude_max_module.py --test "Your message here"

Run Tests:
  python3 test_claude_max_function.py

Authenticate Claude:
  claude auth login

Test Claude CLI:
  claude --print "Hello"

Verify Installation:
  bash verify_installation.sh

Deploy to Docker:
  docker cp openwebui_claude_max_module.py open-webui:/app/backend/data/functions/
  docker restart open-webui

================================================================================
DOCUMENTATION REFERENCES
================================================================================

Quick Overview:
  → README_CLAUDE_MAX.md

Technical Details:
  → OPENWEBUI_CLAUDE_INTEGRATION.md

Installation & Troubleshooting:
  → DEPLOYMENT_GUIDE.md

Complete Summary:
  → IMPLEMENTATION_SUMMARY.md

This Card:
  → QUICK_REFERENCE.txt

================================================================================
REQUIREMENTS
================================================================================

Runtime:
  ✓ Python 3.7+
  ✓ Claude CLI 2.0.0+ (installed: 2.0.55)
  ✓ Claude authentication (via: claude auth login)

Dependencies:
  ✓ None (uses Python stdlib only)

Optional:
  ○ OpenWebUI (for integration, running on port 8080)
  ○ Docker (for containerized deployment)

================================================================================
SECURITY NOTES
================================================================================

✓ Subprocess isolation (no shell injection)
✓ No API keys embedded in code
✓ Auth tokens stored securely by Claude CLI
✓ Structured logging (no sensitive data)
✓ Timeout protection (300s default)
✓ User-friendly error messages (no internal paths)

Remaining Responsibilities:
  • Enable OpenWebUI authentication
  • Use HTTPS in production
  • Don't store API keys in environment

================================================================================
PERFORMANCE
================================================================================

CLI Check: <100ms (cached 5 minutes)
Message Execution: 5-30 seconds (depends on Claude)
Memory: ~50MB process
Network: Direct to Anthropic (no proxies)
Streaming: Real-time chunks

================================================================================
TROUBLESHOOTING QUICK LINKS
================================================================================

Not Finding Claude?
  → See: DEPLOYMENT_GUIDE.md → "Claude CLI not found"

Authentication Issues?
  → See: DEPLOYMENT_GUIDE.md → "Claude CLI requires authentication"

Request Timing Out?
  → See: DEPLOYMENT_GUIDE.md → "Request timed out"

Function Not in OpenWebUI?
  → See: DEPLOYMENT_GUIDE.md → "OpenWebUI Not Finding Function"

General Debugging?
  → Run: python3 openwebui_claude_max_module.py --status

================================================================================
SUPPORT
================================================================================

Status Check:
  python3 openwebui_claude_max_module.py --status

Direct Test:
  python3 openwebui_claude_max_module.py --test "message"

View Logs:
  python3 openwebui_claude_max_module.py --status 2>&1 | grep ERROR

Full Documentation:
  DEPLOYMENT_GUIDE.md (600 lines, comprehensive guide)

Test Suite:
  test_claude_max_function.py (18 tests, all passing)

================================================================================
VERSION & STATUS
================================================================================

Version:        1.0.0
Status:         Production-Ready ✓
Date Created:   2025-11-30
Tests:          18/18 Passing ✓
Code Lines:     550 (main module)
Test Lines:     350 (test suite)
Doc Lines:      1,800+ (4 documents)
Security:       ✓ Subprocess isolation verified
IF.TTT:         ✓ Traceable, Transparent, Trustworthy

================================================================================
                     READY FOR PRODUCTION DEPLOYMENT
================================================================================
