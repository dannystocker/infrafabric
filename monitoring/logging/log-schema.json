{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "if://schema/structured-logs/v1.0",
  "title": "InfraFabric Structured JSON Log Schema",
  "description": "Standardized structured logging format for all InfraFabric agents, components, and services. Enables correlation ID tracking, centralized aggregation, semantic search, and IF.TTT compliance.",
  "type": "object",
  "required": [
    "timestamp",
    "level",
    "agent_id",
    "component",
    "message",
    "correlation_id"
  ],
  "additionalProperties": true,
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp when log entry was created",
      "example": "2025-11-30T12:34:56.789Z"
    },
    "level": {
      "type": "string",
      "enum": [
        "DEBUG",
        "INFO",
        "WARN",
        "ERROR",
        "FATAL"
      ],
      "description": "Log level severity. DEBUG (verbose), INFO (normal), WARN (recoverable), ERROR (attention required), FATAL (system-wide failure)"
    },
    "correlation_id": {
      "type": "string",
      "pattern": "^req-[a-z0-9]{32}$|^task-[a-z0-9]{32}$|^swarm-[a-z0-9]{32}$",
      "description": "Unique correlation ID for tracing a request/task/swarm across all logs. Format: req-UUID | task-UUID | swarm-UUID"
    },
    "agent_id": {
      "type": "string",
      "pattern": "^[a-z0-9]+-[a-z]+-[0-9]{3}$",
      "description": "Unique identifier for the agent generating this log. Format: role-model-instance (e.g., A1-haiku-001, coordinator-sonnet-042)",
      "example": "A1-haiku-001"
    },
    "component": {
      "type": "string",
      "enum": [
        "redis_bus",
        "chromadb",
        "audit_system",
        "openwebui",
        "security",
        "rate_limiter",
        "context_manager",
        "task_scheduler",
        "message_handler",
        "api_gateway",
        "memory_system",
        "guardian_council",
        "system"
      ],
      "description": "Software component or subsystem generating the log"
    },
    "message": {
      "type": "string",
      "description": "Human-readable log message. Should be concise and actionable.",
      "example": "Task claimed successfully"
    },
    "severity": {
      "type": "string",
      "enum": [
        "low",
        "medium",
        "high",
        "critical"
      ],
      "description": "Business/operational severity (for ERROR/FATAL logs). Different from level."
    },
    "service": {
      "type": "string",
      "description": "Service/process name generating the log",
      "example": "infrafabric-agent-pool"
    },
    "environment": {
      "type": "string",
      "enum": [
        "development",
        "staging",
        "production"
      ],
      "description": "Deployment environment"
    },
    "context": {
      "type": "object",
      "description": "Structured contextual data specific to this log entry",
      "additionalProperties": true,
      "example": {
        "task_id": "task:001",
        "duration_ms": 2.1,
        "batch_size": 100,
        "cache_hit": true
      }
    },
    "error": {
      "type": "object",
      "description": "Error details for ERROR/FATAL logs",
      "additionalProperties": true,
      "properties": {
        "type": {
          "type": "string",
          "description": "Exception/error type",
          "example": "ConnectionError"
        },
        "message": {
          "type": "string",
          "description": "Error message"
        },
        "stack_trace": {
          "type": "string",
          "description": "Stack trace for debugging"
        },
        "code": {
          "type": "string",
          "description": "Error code if applicable",
          "example": "ERR_REDIS_CONN"
        }
      }
    },
    "performance": {
      "type": "object",
      "description": "Performance metrics for this operation",
      "additionalProperties": true,
      "properties": {
        "duration_ms": {
          "type": "number",
          "description": "Operation duration in milliseconds"
        },
        "memory_mb": {
          "type": "number",
          "description": "Memory used in MB"
        },
        "cpu_percent": {
          "type": "number",
          "description": "CPU usage percentage"
        }
      }
    },
    "if_citation": {
      "type": "string",
      "pattern": "^if://[a-z]+(/[a-z0-9-]+)+$",
      "description": "IF.citation URI for compliance tracking. Links to audit entry, decision, or source.",
      "example": "if://log/redis-task-claim"
    },
    "trace_id": {
      "type": "string",
      "description": "Optional distributed trace ID for cross-service tracing",
      "example": "trace-abc123def456"
    },
    "user_id": {
      "type": "string",
      "description": "User initiating this action (if applicable)",
      "example": "user-12345"
    },
    "request_id": {
      "type": "string",
      "description": "HTTP request ID (if from API)",
      "example": "req-http-12345"
    },
    "swarm_id": {
      "type": "string",
      "description": "Swarm identifier if part of swarm operations",
      "example": "swarm-primary-001"
    },
    "parent_agent_id": {
      "type": "string",
      "description": "ID of parent/coordinator agent in hierarchical operations"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Optional tags for categorization and filtering",
      "example": ["redis", "task-processing", "batch"]
    },
    "metadata": {
      "type": "object",
      "description": "Additional arbitrary metadata",
      "additionalProperties": true
    }
  }
}
