{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ChromaDB Snapshot Manifest Schema",
  "description": "Schema for snapshot metadata and integrity information",
  "type": "object",
  "required": [
    "snapshot_id",
    "timestamp",
    "chromadb_url",
    "total_chunks",
    "total_collections",
    "checksum_sha256",
    "status"
  ],
  "properties": {
    "snapshot_id": {
      "type": "string",
      "description": "Unique snapshot identifier (format: snapshot_YYYYMMDD_HHMMSS or custom name)",
      "pattern": "^snapshot_[0-9]{8}_[0-9]{6}$|^[a-zA-Z0-9_-]+$"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when snapshot was created",
      "format": "date-time"
    },
    "chromadb_url": {
      "type": "string",
      "description": "Source ChromaDB URL or path",
      "oneOf": [
        {
          "type": "string",
          "pattern": "^http(s)?://.*"
        },
        {
          "type": "string",
          "pattern": "^/.*"
        }
      ]
    },
    "chromadb_version": {
      "type": "string",
      "description": "ChromaDB version at time of snapshot",
      "pattern": "^[0-9]+(\\.[0-9]+)*$"
    },
    "collections": {
      "type": "object",
      "description": "Collection metadata",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "total_documents": {
            "type": "integer",
            "minimum": 0
          },
          "batches": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^batch_[0-9]{6}$"
            }
          }
        }
      }
    },
    "total_chunks": {
      "type": "integer",
      "description": "Total number of documents/chunks in snapshot",
      "minimum": 0
    },
    "total_collections": {
      "type": "integer",
      "description": "Number of collections in snapshot",
      "minimum": 1
    },
    "snapshot_size_mb": {
      "type": "number",
      "description": "Snapshot file size in megabytes",
      "minimum": 0.0
    },
    "checksum_sha256": {
      "type": "string",
      "description": "SHA-256 hash of snapshot archive for integrity verification",
      "pattern": "^[a-f0-9]{64}$"
    },
    "compression_ratio": {
      "type": "number",
      "description": "Compression ratio as percentage (0-100)",
      "minimum": 0,
      "maximum": 100
    },
    "status": {
      "type": "string",
      "description": "Current status of snapshot",
      "enum": [
        "created",
        "verified",
        "restored",
        "failed"
      ]
    },
    "error_message": {
      "type": "string",
      "description": "Error message if status is 'failed'",
      "default": ""
    },
    "retention_until": {
      "type": "string",
      "description": "ISO 8601 timestamp for automatic deletion",
      "format": "date-time"
    },
    "batch_metadata": {
      "type": "object",
      "description": "Mapping of collections to batch keys for incremental rollback",
      "additionalProperties": {
        "type": "array",
        "items": {
          "type": "string",
          "pattern": "^batch_[0-9]{6}$"
        }
      }
    }
  },
  "examples": [
    {
      "snapshot_id": "snapshot_20251130_143022",
      "timestamp": "2025-11-30T14:30:22.123456",
      "chromadb_url": "http://localhost:8000",
      "chromadb_version": "0.3.21",
      "collections": {
        "sergio_personality": {
          "total_documents": 2458,
          "batches": [
            "batch_000000",
            "batch_000001",
            "batch_000002",
            "batch_000003"
          ]
        },
        "sergio_rhetorical": {
          "total_documents": 3294,
          "batches": [
            "batch_000000",
            "batch_000001",
            "batch_000002",
            "batch_000003"
          ]
        },
        "sergio_humor": {
          "total_documents": 1850,
          "batches": [
            "batch_000000",
            "batch_000001"
          ]
        },
        "sergio_corpus": {
          "total_documents": 2230,
          "batches": [
            "batch_000000",
            "batch_000001",
            "batch_000002"
          ]
        }
      },
      "total_chunks": 9832,
      "total_collections": 4,
      "snapshot_size_mb": 28.4,
      "checksum_sha256": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234",
      "compression_ratio": 72.3,
      "status": "created",
      "error_message": "",
      "retention_until": "2025-12-07T14:30:22.123456",
      "batch_metadata": {
        "sergio_personality": [
          "batch_000000",
          "batch_000001",
          "batch_000002",
          "batch_000003"
        ],
        "sergio_rhetorical": [
          "batch_000000",
          "batch_000001",
          "batch_000002",
          "batch_000003"
        ],
        "sergio_humor": [
          "batch_000000",
          "batch_000001"
        ],
        "sergio_corpus": [
          "batch_000000",
          "batch_000001",
          "batch_000002"
        ]
      }
    }
  ]
}
